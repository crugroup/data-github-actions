name: Validate PR

on:
  pull_request_target:
    types:
      - opened
      - synchronize
      - edited
      - reopened
    branches:
      - 'develop'

jobs:
  validate-pr:
    runs-on: ubuntu-latest
    permissions:
      pull-requests: read
      contents: read
    steps:
      - name: Validate PR title and body
        uses: actions/github-script@v7
        with:
          script: |
            const prTitle = context.payload.pull_request.title;
            const prBody = context.payload.pull_request.body || '';
            const branchName = context.payload.pull_request.head.ref;

            if (!prBody.trim()) {
              core.setFailed('PR body must not be empty');
              return;
            }

            // Require PR title to start with a Jira issue key in brackets, e.g. "[ABC-123] ..."
            // Project key: letters only (no digits). Case-insensitive to allow "[abc-123]".
            const jiraKeyRegex = /^\[[A-Z]{2,}-\d+\](?:\s|$)/i;

            if (!jiraKeyRegex.test(prTitle)) {
              core.setFailed('PR title must start with a Jira ticket key like "[ABC-123]"');
              return;
            }

            core.info('PR title starts with a Jira ticket key');